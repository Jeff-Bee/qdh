
@{
    ViewBag.Title = "找回密码";
    Layout = "~/Views/Shared/BaseToolbarView.cshtml";
}


    <link rel="stylesheet" type="text/css" href="~/css/site.css">


<script>

    //$(document).ready(function () {
    //    $("#txtPhoneNumber").val("15803818280");

    //    $("#txtPhoneNumber").textbox('setValue', "15803818280");

    //});




    var count = 10;

    function countdown() {
        $("#btnGetCode").val(count + "s后再次获取");
        count--;
        if (count > 0) {
            setTimeout("countdown()", 1000);
        } else {
            //$("#btnGetCode").removeClass("unable");
            //$("#btnGetCode").removeAttr("disabled");
            $('#btnGetCode').linkbutton('enable');

            $("#btnGetCode").val("获取验证码");
        }
    }





    function GetRegisterCode(sender) {
        var num = $("#txtPhoneNumber").val();
        if (num == null || num == undefined || num == '') {
            showWarnToast("请输入手机号!");
            return;
        } 

        //$("#btnGetCode").attr("disabled", "disabled");
        //$("#btnGetCode").addClass("unable");
        $('#btnGetCode').linkbutton('disable');
        count = 60;
        countdown();




        function successFunc(data, status) {

            if (data.Success) {

            } else {

            }


           // $("#txtRegisterCode").textbox('setValue', data.Data);
        }

        function showAjaxErrorInfo(xmlHttpRequest, textStatus, errorThrown) {
            //XMLHttpRequest.readyState: 状态码的意思
            //0 － （未初始化）还没有调用send()方法
            //1 － （载入）已调用send()方法，正在发送请求
            //2 － （载入完成）send()方法执行完成，已经接收到全部响应内容
            //3 － （交互）正在解析响应内容
            //4 － （完成）响应内容解析完成，可以在客户端调用了



            console.log("status:" + xmlHttpRequest.status);
            console.log("readyState:" + xmlHttpRequest.readyState);
            console.log("textStatus:" + textStatus);



            $("#txtRegisterCode").textbox('setValue', "error:" + xmlHttpRequest.readyState);
        }

        //'<%= Url.Action("GetRegisterCode") %>'
  //      var serviceURL = "'"+ @Url.Action("LostPwd")+"'";
        
        var param = "{ 'phoneNumber':'" + num + "'}";
        console.log(num);
        console.log(param);


        $.ajax({
            type: "POST",
            url: 'GetRegisterCode',
            data: "{ 'phoneNumber':'" + num + "'}",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: successFunc,
            error: showAjaxErrorInfo
        });



    }

</script>


@using (Html.BeginForm(new {ViewBag.ReturnUrl}))
{
    @Html.ValidationSummary(true)

    <div style="margin: 20px auto; width: 100px; height: 100px; border-radius: 100px; overflow: hidden">
        <img src="~/images/login1.png" style="margin: 0; width: 100%; height: 100%;">
    </div>
    <div style="padding: 0 20px">

        <div style="margin-bottom: 10px">
            <input id="txtPhoneNumber" class="easyui-textbox" name="PhoneNumber" data-options="prompt:'请输入手机号',iconCls:'icon-man'" style="width: 100%; height: 38px">
        </div>

        <div style="margin-bottom: 10px; height: 50px;">
            <input id="txtRegisterCode" class="easyui-textbox" name="RegisterCode" data-options="prompt:'请输入验证码',iconCls:'icon-man'" style="width: 50%; height: 38px;">
            <input id="btnGetCode" class="easyui-linkbutton" style="width: 30%; margin-left: 40px; height: 38px; " type="button" value="获取验证码" onclick="GetRegisterCode(this)">
        </div>

        @*<div style="margin-bottom: 10px">
                <input class="easyui-textbox" name="LoginName" data-options="prompt:'请输入登录名',iconCls:'icon-man'" style="width: 100%; height: 38px">
            </div>*@


        <div style="text-align: center; margin-top: 30px">
            <input type="submit" value="找回密码" class="weui-btn weui-btn_primary" onclick="click"/>
        </div>


        <div style="text-align: center; margin-top: 30px; text-align: center;">
            @Html.ActionLink("登录", "Login")
        </div>


    </div>
}

